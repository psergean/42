/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   mat_inverse4x4.c                                   :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: tapperce <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2018/02/12 14:58:01 by tapperce          #+#    #+#             */
/*   Updated: 2018/02/27 14:18:27 by tapperce         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "libvec.h"

static double	get_det(double **mat)
{
	double	det;

	det = mat[0][0] * mat[1][1] * mat[2][2] * mat[3][3] +
		mat[0][0] * mat[1][2] * mat[2][3] * mat[3][1] +
		mat[0][0] * mat[1][3] * mat[2][1] * mat[3][2] +
		mat[0][1] * mat[1][0] * mat[2][3] * mat[3][2] +
		mat[0][1] * mat[1][2] * mat[2][0] * mat[3][3] +
		mat[0][1] * mat[1][3] * mat[2][2] * mat[3][0] +
		mat[0][2] * mat[1][0] * mat[2][1] * mat[3][3] +
		mat[0][2] * mat[1][1] * mat[2][3] * mat[3][0] +
		mat[0][2] * mat[1][3] * mat[2][0] * mat[3][1] +
		mat[0][3] * mat[1][0] * mat[2][2] * mat[3][1] +
		mat[0][3] * mat[1][1] * mat[2][0] * mat[3][2] +
		mat[0][3] * mat[1][2] * mat[2][1] * mat[3][0] -
		mat[0][0] * mat[1][1] * mat[2][3] * mat[3][2] -
		mat[0][0] * mat[1][2] * mat[2][1] * mat[3][3] -
		mat[0][0] * mat[1][3] * mat[2][2] * mat[3][1] -
		mat[0][1] * mat[1][0] * mat[2][2] * mat[3][3] -
		mat[0][1] * mat[1][2] * mat[2][3] * mat[3][0] -
		mat[0][1] * mat[1][3] * mat[2][0] * mat[3][2] -
		mat[0][2] * mat[1][0] * mat[2][3] * mat[3][1] -
		mat[0][2] * mat[1][1] * mat[2][0] * mat[3][3] -
		mat[0][2] * mat[1][3] * mat[2][1] * mat[3][0] -
		mat[0][3] * mat[1][0] * mat[2][1] * mat[3][2] -
		mat[0][3] * mat[1][1] * mat[2][2] * mat[3][0] -
		mat[0][3] * mat[1][2] * mat[2][0] * mat[3][1];
	return(det);
}

static void		get_row0(double *r, double d, double **m)
{
	r[0] = m[1][1] * m[2][2] * m[3][3] + m[1][2] * m[2][3] * m[3][1]
		+ m[1][3] * m[2][1] * m[3][2] - m[1][1] * m[2][3] * m[3][2]
		- m[1][2] * m[2][1] * m[3][3] - m[1][3] * m[2][2] * m[3][1];
	r[1] = m[0][1] * m[2][3] * m[3][2] + m[0][2] * m[2][1] * m[3][3]
		+ m[0][3] * m[2][2] * m[3][1] - m[0][1] * m[2][2] * m[3][3]
		- m[0][2] * m[2][3] * m[3][1] - m[0][3] * m[2][1] * m[3][2];
	r[2] = m[0][1] * m[1][2] * m[3][3] + m[0][2] * m[1][3] * m[3][1]
		+ m[0][3] * m[1][1] * m[3][2] - m[0][1] * m[1][3] * m[3][2]
		- m[0][2] * m[1][1] * m[3][3] - m[0][3] * m[1][2] * m[3][1];
	r[3] = m[0][1] * m[1][3] * m[2][2] + m[0][2] * m[1][1] * m[2][3]
		+ m[0][3] * m[1][2] * m[2][1] - m[0][1] * m[1][2] * m[2][3]
		- m[0][2] * m[1][3] * m[2][1] - m[0][3] * m[1][1] * m[2][2];
	r[0] *= d;
	r[1] *= d;
	r[2] *= d;
	r[3] *= d;
}

static void		get_row1(double *r, double d, double **m)
{
	r[0] = m[1][0] * m[2][3] * m[3][2] + m[1][2] * m[2][0] * m[3][3]
		+ m[1][3] * m[2][2] * m[3][0] - m[1][0] * m[2][2] * m[3][3]
		- m[1][2] * m[2][3] * m[3][0] - m[1][3] * m[2][0] * m[3][2];
	r[1] = m[0][0] * m[2][2] * m[3][3] + m[0][2] * m[2][3] * m[3][0]
		+ m[0][3] * m[2][0] * m[3][2] - m[0][0] * m[2][3] * m[3][2]
		- m[0][2] * m[2][0] * m[3][3] - m[0][3] * m[2][2] * m[3][0];
	r[2] = m[0][0] * m[1][3] * m[3][2] + m[0][2] * m[1][0] * m[3][3]
		+ m[0][3] * m[1][2] * m[3][0] - m[0][0] * m[1][2] * m[3][3]
		- m[0][2] * m[1][3] * m[3][0] - m[0][3] * m[1][0] * m[3][2];
	r[3] = m[0][0] * m[1][2] * m[2][3] + m[0][2] * m[1][3] * m[2][0]
		+ m[0][3] * m[1][0] * m[2][2] - m[0][0] * m[1][3] * m[2][2]
		- m[0][2] * m[1][0] * m[2][3] - m[0][3] * m[1][2] * m[2][0];
	r[0] *= d;
	r[1] *= d;
	r[2] *= d;
	r[3] *= d;
}

static void		get_row2(double *r, double d, double **m)
{
	r[0] = m[1][0] * m[2][1] * m[3][3] + m[1][1] * m[2][3] * m[3][0]
		+ m[1][3] * m[2][0] * m[3][1] - m[1][0] * m[2][3] * m[3][1]
		- m[1][1] * m[2][0] * m[3][3] - m[1][3] * m[2][1] * m[3][0];
	r[1] = m[0][0] * m[2][3] * m[3][1] + m[0][1] * m[2][0] * m[3][3]
		+ m[0][3] * m[2][1] * m[3][0] - m[0][0] * m[2][1] * m[3][3]
		- m[0][1] * m[2][3] * m[3][0] - m[0][3] * m[2][0] * m[3][1];
	r[2] = m[0][0] * m[1][1] * m[3][3] + m[0][1] * m[1][3] * m[3][0]
		+ m[0][3] * m[1][0] * m[3][1] - m[0][0] * m[1][3] * m[3][1]
		- m[0][1] * m[1][0] * m[3][3] - m[0][3] * m[1][1] * m[3][0];
	r[3] = m[0][0] * m[1][3] * m[2][1] + m[0][1] * m[1][0] * m[2][3]
		+ m[0][3] * m[1][1] * m[2][0] - m[0][0] * m[1][1] * m[2][3]
		- m[0][1] * m[1][3] * m[2][0] - m[0][3] * m[1][0] * m[2][1];
	r[0] *= d;
	r[1] *= d;
	r[2] *= d;
	r[3] *= d;
}

static void		get_row3(double *r, double d, double **m)
{
	r[0] = m[1][0] * m[2][2] * m[3][1] + m[1][1] * m[2][0] * m[3][2]
		+ m[1][2] * m[2][1] * m[3][0] - m[1][0] * m[2][1] * m[3][2]
		- m[1][1] * m[2][2] * m[3][0] - m[1][2] * m[2][0] * m[3][1];
	r[1] = m[0][0] * m[2][1] * m[3][2] + m[0][1] * m[2][2] * m[3][0]
		+ m[0][2] * m[2][0] * m[3][1] - m[0][0] * m[2][2] * m[3][1]
		- m[0][1] * m[2][0] * m[3][2] - m[0][2] * m[2][1] * m[3][0];
	r[2] = m[0][0] * m[1][2] * m[3][1] + m[0][1] * m[1][0] * m[3][2]
		+ m[0][2] * m[1][1] * m[3][0] - m[0][0] * m[1][1] * m[3][2]
		- m[0][1] * m[1][2] * m[3][0] - m[0][2] * m[1][0] * m[3][1];
	r[3] = m[0][0] * m[1][1] * m[2][2] + m[0][1] * m[1][2] * m[2][0]
		+ m[0][2] * m[1][0] * m[2][1] - m[0][0] * m[1][2] * m[2][1]
		- m[0][1] * m[1][0] * m[2][2] - m[0][2] * m[1][1] * m[2][0];
	r[0] *= d;
	r[1] *= d;
	r[2] *= d;
	r[3] *= d;
}

double		**mat_inverse4x4(double **mat)
{
	double	**inv;
	double	inv_det;
	double	det;
	int		i;

	i = -1;
	inv = mat_create44();
	det = get_det(mat);
	if (det != 0)
		inv_det = 1 / det;
	else
		return (NULL);
	get_row0(inv[0], inv_det, mat);
	get_row1(inv[1], inv_det, mat);
	get_row2(inv[2], inv_det, mat);
	get_row3(inv[3], inv_det, mat);
	return(inv);
}
